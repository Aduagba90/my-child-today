<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SMS - My Child Today</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Shared dashboard CSS -->
  <link rel="stylesheet" href="css/dashboard.css">

  <style>
    .content { padding-bottom: 40px; }
    .search-row { max-width: 50%; min-width: 300px; }
    .filters-row .form-select { min-width: 180px; }
    .filters-row .btn { white-space: nowrap; }
    .table thead th { background-color: #f1f5f1; }
    .action-btn { cursor: pointer; font-weight: 600; text-decoration: none; }
    .action-btn:hover { text-decoration: underline; }

    @media (max-width: 992px) {
      .search-row { max-width: 100%; }
      .filters-row { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
    }

    /* --------------------------------------
Global Font & Layout Adjustments
--------------------------------------- */
body, .sidebar, .content, .card, .table, button, a, h1, h2, h3, h4, h5, h6, p, span, td, th {
  font-size: 11px !important;
  line-height: 1.2 !important;
  font-family: 'Roboto', sans-serif;
  color: #333;
}

/* Headings slightly larger for clarity */
h1, h2, h3 {
  font-size: 13px !important;
  font-weight: 600 !important;
}

/* --------------------------------------
Sidebar Styling (Fixed + Gray Theme)
--------------------------------------- */
.sidebar {
  width: 190px !important;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  overflow-y: auto;
  background-color: #2f3e46; /* elegant gray-blue tone */
  color: #fff !important;
  z-index: 100;
  padding-top: 1rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

/* Sidebar Header */
.sidebar .sidebar-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 0.8rem;
  padding: 0 10px;
}
.sidebar .sidebar-header span {
  font-size: 11px !important;
  font-weight: 600;
  color: #fff !important;
}

/* Sidebar Links */
.sidebar .nav-links {
  flex-grow: 1;
}
.sidebar .nav-link {
  display: flex;
  align-items: center;
  font-size: 10.5px !important;
  padding: 6px 10px !important;
  border-radius: 6px;
  color: #e0e0e0 !important;
  transition: background 0.25s ease, color 0.25s ease;
}
.sidebar .nav-link i {
  font-size: 13px !important;
  margin-right: 6px;
}

/* Active or Hover States */
.sidebar .nav-link:hover,
.sidebar .nav-link.active {
  background-color: #009688; /* teal-blue highlight */
  color: #fff !important;
}

/* --------------------------------------
Logout Button (Bottom of Sidebar)
--------------------------------------- */
.logout-section {
  padding: 0.5rem 10px !important;
  width: 100%;
  border-top: 1px solid rgba(255, 255, 255, 0.2);
}
.logout-btn {
  font-size: 10px !important;
  padding: 5px 8px !important;
  border-radius: 5px !important;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  width: 100%;
  background-color: #dc3545;
  color: #fff !important;
  border: none;
  transition: background 0.2s ease;
}
.logout-btn i {
  font-size: 12px !important;
}
.logout-btn:hover {
  background-color: #c82333;
}

/* --------------------------------------
Dashboard Content Area
--------------------------------------- */
.content {
  margin-left: 190px;
  padding: 1rem !important;
  font-size: 11px !important;
  background-color: #f8f9fa;
  min-height: 100vh;
}

/* --------------------------------------
Cards and Stats
--------------------------------------- */
.card {
  padding: 0.6rem !important;
  border-radius: 8px !important;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  background-color: #fff;
}
.stat-card h6 {
  font-size: 10px !important;
}
.stat-card h3 {
  font-size: 15px !important;
}
.stat-icon {
  font-size: 1.2rem !important;
}

/* --------------------------------------
Tables
--------------------------------------- */
.table th, .table td {
  font-size: 10px !important;
  padding: 4px 6px !important;
  vertical-align: middle !important;
}
.table th {
  font-weight: 600 !important;
}

/* --------------------------------------
Charts
--------------------------------------- */
.chart-container {
  font-size: 10px !important;
}
canvas {
  max-height: 180px !important;
}

/* --------------------------------------
Floating CTA
--------------------------------------- */
.floating-cta {
  font-size: 10.5px !important;
  padding: 7px 12px !important;
  border-radius: 30px !important;
  position: fixed;
  bottom: 25px;
  right: 25px;
  z-index: 200;
  background-color: #009688;
  color: #fff;
  border: none;
  transition: background 0.25s ease;
}
.floating-cta:hover {
  background-color: #00796b;
}

/* --------------------------------------
Alignment Cleanup
--------------------------------------- */
.row, .col-md-4, .col-md-6 {
  margin: 0 !important;
  padding: 0.3rem !important;
}
  </style>
</head>
<body>
  <div class="d-flex">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="sidebar-header d-flex align-items-center mb-4">
        <i class="bi bi-mortarboard-fill sidebar-icon"></i>
        <span class="fw-bold">School Admin</span>
      </div>

      <ul class="nav flex-column px-3">
        <li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
        <li class="nav-item"><a href="students.html" class="nav-link"><i class="bi bi-people me-2"></i>Students</a></li>
        <li class="nav-item"><a href="attendance.html" class="nav-link"><i class="bi bi-check-circle me-2"></i>Attendance</a></li>
        <li class="nav-item"><a href="sms.html" class="nav-link active"><i class="bi bi-chat-dots me-2"></i>SMS</a></li>
        <li class="nav-item"><a href="reports.html" class="nav-link"><i class="bi bi-graph-up me-2"></i>Reports</a></li>
      </ul>

      <div class="logout-section mt-auto px-3 mb-3">
        <button class="logout-btn w-100 btn btn-outline-danger"><i class="bi bi-box-arrow-right me-2"></i>Logout</button>
      </div>
    </nav>

    <!-- Main content -->
    <main class="content flex-grow-1 p-4">
      <!-- Search bar -->
      <div class="mb-3">
        <div class="input-group search-row">
          <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
          <input id="smsSearchInput" type="text" class="form-control border-start-0" placeholder="Search recipients..." aria-label="Search recipients">
        </div>
      </div>
      <hr>

      <!-- Header row -->
      <div class="d-flex justify-content-between align-items-start mb-4 flex-wrap">
        <div>
          <h3 class="fw-bold mb-1">SMS Dashboard</h3>
          <p class="text-muted mb-0">Send and manage messages to students and parents</p>
        </div>
        <div class="text-end mt-2">
          <div class="d-flex align-items-center justify-content-end">
            <i class="bi bi-calendar-date text-success me-2 fs-5"></i>
            <div id="currentDateSMS" class="fw-semibold text-muted"></div>
          </div>
        </div>
      </div>

      <!-- Filters row -->
      <div class="d-flex justify-content-between align-items-center mb-4 filters-row flex-wrap">
        <div class="d-flex align-items-center gap-2">
          <select id="smsClassSelect" class="form-select">
            <option value="all">All Classes</option>
            <option value="jss1a">JSS 1A</option>
            <option value="jss2a">JSS 2A</option>
            <option value="sss1a">SSS 1A</option>
            <option value="sss1b">SSS 1B</option>
          </select>

          <select id="smsTypeSelect" class="form-select">
            <option value="all">All Types</option>
            <option value="Notification">Notification</option>
            <option value="Reminder">Reminder</option>
            <option value="Custom">Custom</option>
          </select>

          <button id="smsFilterBtn" class="btn btn-success">Filter</button>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#sendSMSModal">
            <i class="bi bi-plus-circle me-1"></i>Send SMS
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="card shadow-sm p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="fw-bold mb-0">SMS Messages</h6>
        </div>

        <div class="table-responsive" style="max-height:520px; overflow:auto;">
          <table id="smsTable" class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Recipient</th>
                <th>Type</th>
                <th>Message</th>
                <th>Class</th>
                <th>Date Sent</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr data-class="jss1a" data-type="Notification">
                <td>Aliyu Musa</td>
                <td>Notification</td>
                <td>Reminder: Attendance today</td>
                <td>JSS 1A</td>
                <td>21/10/2025</td>
                <td>
                  <a class="action-btn text-primary me-2">View/Edit</a>
                  <a class="action-btn text-danger">Delete</a>
                </td>
              </tr>
              <tr data-class="sss1a" data-type="Custom">
                <td>Maryam Bello</td>
                <td>Custom</td>
                <td>Happy birthday Maryam!</td>
                <td>SSS 1A</td>
                <td>20/10/2025</td>
                <td>
                  <a class="action-btn text-primary me-2">View/Edit</a>
                  <a class="action-btn text-danger">Delete</a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Send/Edit SMS Modal -->
  <div class="modal fade" id="sendSMSModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="smsModalTitle"><i class="bi bi-chat-dots me-2"></i>Send SMS</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="smsForm">
            <input type="hidden" id="editSmsIndex">
            <div class="mb-3">
              <label class="form-label">Recipient (optional for bulk)</label>
              <input type="text" class="form-control" id="smsRecipient" placeholder="Student or Parent Name">
            </div>
            <div class="mb-3">
              <label class="form-label">Type</label>
              <select id="smsType" class="form-select" required>
                <option>Notification</option>
                <option>Reminder</option>
                <option>Custom</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Class</label>
              <select id="smsClass" class="form-select" required>
                <option>JSS 1A</option>
                <option>JSS 2A</option>
                <option>SSS 1A</option>
                <option>SSS 1B</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Message</label>
              <textarea id="smsMessage" class="form-control" rows="3" placeholder="Type your message here..." required></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-success" id="smsSaveBtn">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.getElementById('currentDateSMS').textContent = new Date().toLocaleDateString();

    const smsTable = document.querySelector('#smsTable tbody');
    const smsForm = document.getElementById('smsForm');
    const smsModal = new bootstrap.Modal('#sendSMSModal');
    const smsModalTitle = document.getElementById('smsModalTitle');
    const smsSaveBtn = document.getElementById('smsSaveBtn');

    // Example student list per class for bulk simulation
    const studentsByClass = {
      jss1a: ['Aliyu Musa','Fatima Umar','Hassan Bello'],
      jss2a: ['Aisha Ibrahim','Abubakar Sani'],
      sss1a: ['Maryam Bello','John Doe'],
      sss1b: ['Sara Ahmed','Michael Johnson']
    };

    function resetForm() {
      smsForm.reset();
      document.getElementById('editSmsIndex').value = '';
      smsModalTitle.innerHTML = '<i class="bi bi-chat-dots me-2"></i>Send SMS';
      smsSaveBtn.textContent = 'Send';
    }

    // Open modal for send/edit or delete
    smsTable.addEventListener('click', e => {
      const row = e.target.closest('tr');
      if (!row) return;

      if (e.target.textContent.includes('View/Edit')) {
        const index = [...smsTable.rows].indexOf(row);
        document.getElementById('editSmsIndex').value = index;
        document.getElementById('smsRecipient').value = row.cells[0].innerText;
        document.getElementById('smsType').value = row.cells[1].innerText;
        document.getElementById('smsClass').value = row.cells[3].innerText;
        document.getElementById('smsMessage').value = row.cells[2].innerText;
        smsModalTitle.innerHTML = '<i class="bi bi-pencil-square me-2"></i>Edit SMS';
        smsSaveBtn.textContent = 'Update';
        smsModal.show();
      }

      if (e.target.textContent.includes('Delete')) {
        if (confirm('Are you sure you want to delete this SMS?')) {
          row.remove();
        }
      }
    });

    // Save or update SMS with bulk sending support
    smsSaveBtn.addEventListener('click', () => {
      const recipient = document.getElementById('smsRecipient').value.trim();
      const type = document.getElementById('smsType').value;
      const smsClass = document.getElementById('smsClass').value;
      const message = document.getElementById('smsMessage').value.trim();
      if (!message) return;

      const editIndex = document.getElementById('editSmsIndex').value;
      const today = new Date().toLocaleDateString();

      if (editIndex === '') {
        // Bulk sending: if recipient is empty, send to all students in class
        const recipients = recipient ? [recipient] : (studentsByClass[smsClass.toLowerCase()] || []);
        recipients.forEach(r => {
          const row = smsTable.insertRow();
          row.dataset.class = smsClass.toLowerCase();
          row.dataset.type = type;
          row.innerHTML = `
            <td>${r}</td>
            <td>${type}</td>
            <td>${message}</td>
            <td>${smsClass}</td>
            <td>${today}</td>
            <td>
              <a class="action-btn text-primary me-2">View/Edit</a>
              <a class="action-btn text-danger">Delete</a>
            </td>
          `;
        });
      } else {
        const row = smsTable.rows[editIndex];
        row.dataset.class = smsClass.toLowerCase();
        row.dataset.type = type;
        row.cells[0].innerText = recipient;
        row.cells[1].innerText = type;
        row.cells[2].innerText = message;
        row.cells[3].innerText = smsClass;
        row.cells[4].innerText = today;
      }

      smsModal.hide();
      resetForm();
      applyFilters();
    });

    document.getElementById('sendSMSModal').addEventListener('hidden.bs.modal', resetForm);

    // Search functionality
    document.getElementById('smsSearchInput').addEventListener('input', e => {
      applyFilters();
    });

    // Filter functionality
    document.getElementById('smsFilterBtn').addEventListener('click', applyFilters);

    function applyFilters() {
      const classFilter = document.getElementById('smsClassSelect').value.toLowerCase();
      const typeFilter = document.getElementById('smsTypeSelect').value.toLowerCase();
      const searchQuery = document.getElementById('smsSearchInput').value.toLowerCase();

      [...smsTable.rows].forEach(row => {
        const rowClass = row.dataset.class;
        const rowType = row.dataset.type.toLowerCase();
        const rowRecipient = row.cells[0].innerText.toLowerCase();

        if ((classFilter === 'all' || rowClass === classFilter) &&
            (typeFilter === 'all' || rowType === typeFilter) &&
            rowRecipient.includes(searchQuery)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // Logout confirmation and redirect
    document.querySelector('.logout-btn').addEventListener('click', () => {
      const confirmLogout = confirm('Are you sure you want to logout?');
      if (confirmLogout) {
        window.location.href = '../login.html'; // Redirect to login page
      }
    });
  </script>
</body>
</html>
