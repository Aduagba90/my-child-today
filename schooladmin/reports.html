<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reports - My Child Today</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Shared dashboard CSS -->
  <link rel="stylesheet" href="css/dashboard.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .content { padding-bottom: 40px; }
    .filters-row .form-select, .filters-row .btn, .filters-row .form-control { min-width: 150px; }
    .table thead th { background-color: #f1f5f1; }
    .action-btn { cursor: pointer; font-weight: 600; text-decoration: none; }
    .action-btn:hover { text-decoration: underline; }
    @media (max-width: 992px) {
      .filters-row { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
    }
    .summary-badge { font-size: 0.9rem; padding: 0.5rem 0.75rem; margin-right: 0.5rem; }

    /* --------------------------------------
Global Font & Layout Adjustments
--------------------------------------- */
body, .sidebar, .content, .card, .table, button, a, h1, h2, h3, h4, h5, h6, p, span, td, th {
  font-size: 11px !important;
  line-height: 1.2 !important;
  font-family: 'Roboto', sans-serif;
  color: #333;
}

/* Headings slightly larger for clarity */
h1, h2, h3 {
  font-size: 13px !important;
  font-weight: 600 !important;
}

/* --------------------------------------
Sidebar Styling (Fixed + Gray Theme)
--------------------------------------- */
.sidebar {
  width: 190px !important;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  overflow-y: auto;
  background-color: #2f3e46; /* elegant gray-blue tone */
  color: #fff !important;
  z-index: 100;
  padding-top: 1rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

/* Sidebar Header */
.sidebar .sidebar-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 0.8rem;
  padding: 0 10px;
}
.sidebar .sidebar-header span {
  font-size: 11px !important;
  font-weight: 600;
  color: #fff !important;
}

/* Sidebar Links */
.sidebar .nav-links {
  flex-grow: 1;
}
.sidebar .nav-link {
  display: flex;
  align-items: center;
  font-size: 10.5px !important;
  padding: 6px 10px !important;
  border-radius: 6px;
  color: #e0e0e0 !important;
  transition: background 0.25s ease, color 0.25s ease;
}
.sidebar .nav-link i {
  font-size: 13px !important;
  margin-right: 6px;
}

/* Active or Hover States */
.sidebar .nav-link:hover,
.sidebar .nav-link.active {
  background-color: #009688; /* teal-blue highlight */
  color: #fff !important;
}

/* --------------------------------------
Logout Button (Bottom of Sidebar)
--------------------------------------- */
.logout-section {
  padding: 0.5rem 10px !important;
  width: 100%;
  border-top: 1px solid rgba(255, 255, 255, 0.2);
}
.logout-btn {
  font-size: 10px !important;
  padding: 5px 8px !important;
  border-radius: 5px !important;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  width: 100%;
  background-color: #dc3545;
  color: #fff !important;
  border: none;
  transition: background 0.2s ease;
}
.logout-btn i {
  font-size: 12px !important;
}
.logout-btn:hover {
  background-color: #c82333;
}

/* --------------------------------------
Dashboard Content Area
--------------------------------------- */
.content {
  margin-left: 190px;
  padding: 1rem !important;
  font-size: 11px !important;
  background-color: #f8f9fa;
  min-height: 100vh;
}

/* --------------------------------------
Cards and Stats
--------------------------------------- */
.card {
  padding: 0.6rem !important;
  border-radius: 8px !important;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  background-color: #fff;
}
.stat-card h6 {
  font-size: 10px !important;
}
.stat-card h3 {
  font-size: 15px !important;
}
.stat-icon {
  font-size: 1.2rem !important;
}

/* --------------------------------------
Tables
--------------------------------------- */
.table th, .table td {
  font-size: 10px !important;
  padding: 4px 6px !important;
  vertical-align: middle !important;
}
.table th {
  font-weight: 600 !important;
}

/* --------------------------------------
Charts
--------------------------------------- */
.chart-container {
  font-size: 10px !important;
}
canvas {
  max-height: 180px !important;
}

/* --------------------------------------
Floating CTA
--------------------------------------- */
.floating-cta {
  font-size: 10.5px !important;
  padding: 7px 12px !important;
  border-radius: 30px !important;
  position: fixed;
  bottom: 25px;
  right: 25px;
  z-index: 200;
  background-color: #009688;
  color: #fff;
  border: none;
  transition: background 0.25s ease;
}
.floating-cta:hover {
  background-color: #00796b;
}

/* --------------------------------------
Alignment Cleanup
--------------------------------------- */
.row, .col-md-4, .col-md-6 {
  margin: 0 !important;
  padding: 0.3rem !important;
}
  </style>
</head>
<body>
<div class="d-flex">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header d-flex align-items-center mb-4">
      <i class="bi bi-mortarboard-fill sidebar-icon"></i>
      <span class="fw-bold">School Admin</span>
    </div>
    <ul class="nav flex-column px-3">
      <li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
      <li class="nav-item"><a href="students.html" class="nav-link"><i class="bi bi-people me-2"></i>Students</a></li>
      <li class="nav-item"><a href="attendance.html" class="nav-link"><i class="bi bi-check-circle me-2"></i>Attendance</a></li>
      <li class="nav-item"><a href="sms.html" class="nav-link"><i class="bi bi-chat-dots me-2"></i>SMS</a></li>
      <li class="nav-item"><a href="reports.html" class="nav-link active"><i class="bi bi-graph-up me-2"></i>Reports</a></li>
    </ul>
    <div class="logout-section mt-auto px-3 mb-3">
      <button class="logout-btn w-100 btn btn-danger"><i class="bi bi-box-arrow-right me-2"></i>Logout</button>
    </div>
  </nav>

  <!-- Main content -->
  <main class="content flex-grow-1 p-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-start mb-4 flex-wrap">
      <div>
        <h3 class="fw-bold mb-1">Reports Dashboard</h3>
        <p class="text-muted mb-0">View and export summaries for SMS, Attendance, and more</p>
      </div>
      <div class="text-end mt-2">
        <div class="d-flex align-items-center justify-content-end">
          <i class="bi bi-calendar-date text-success me-2 fs-5"></i>
          <div id="currentDateReports" class="fw-semibold text-muted"></div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="d-flex justify-content-between align-items-center mb-4 filters-row flex-wrap">
      <div class="d-flex align-items-center gap-2 flex-wrap">
        <select id="reportClassSelect" class="form-select">
          <option value="all">All Classes</option>
          <option value="jss1a">JSS 1A</option>
          <option value="jss2a">JSS 2A</option>
          <option value="sss1a">SSS 1A</option>
          <option value="sss1b">SSS 1B</option>
        </select>
        <select id="reportTypeSelect" class="form-select">
          <option value="all">All Types</option>
          <option value="SMS">SMS</option>
          <option value="Attendance">Attendance</option>
        </select>
        <input type="date" id="reportStartDate" class="form-control" placeholder="From">
        <input type="date" id="reportEndDate" class="form-control" placeholder="To">
        <button id="reportFilterBtn" class="btn btn-success">Filter</button>
        <button id="reportExportBtn" class="btn btn-primary"><i class="bi bi-file-earmark-arrow-down me-1"></i>Export</button>
      </div>
    </div>

    <!-- Reports Table -->
    <div class="card shadow-sm p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="fw-bold mb-0">Reports</h6>
      </div>
      <div class="table-responsive" style="max-height:520px; overflow:auto;">
        <table id="reportTable" class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Class</th>
              <th>Type</th>
              <th>Details</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr data-class="jss1a" data-type="SMS" data-date="2025-10-21">
              <td>JSS 1A</td>
              <td>SMS</td>
              <td>3 messages sent</td>
              <td>21/10/2025</td>
              <td><a class="action-btn text-primary me-2 viewReportBtn">View</a></td>
            </tr>
            <tr data-class="sss1a" data-type="Attendance" data-date="2025-10-20">
              <td>SSS 1A</td>
              <td>Attendance</td>
              <td>Attendance marked for 25 students</td>
              <td>20/10/2025</td>
              <td><a class="action-btn text-primary me-2 viewReportBtn">View</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>

<!-- Report Modal -->
<div class="modal fade" id="reportModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="reportModalTitle"><i class="bi bi-clipboard-data me-2"></i>Report Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="reportModalBody">
        <!-- Dynamic content will be filled by JS -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.getElementById('currentDateReports').textContent = new Date().toLocaleDateString();

const reportTable = document.querySelector('#reportTable tbody');
const reportModal = new bootstrap.Modal('#reportModal');
const reportModalTitle = document.getElementById('reportModalTitle');
const reportModalBody = document.getElementById('reportModalBody');
let chartInstance;

// Logout confirmation
document.querySelector('.logout-btn').addEventListener('click', function() {
  const confirmLogout = confirm("Are you sure you want to logout?");
  if (confirmLogout) {
    window.location.href = "../login.html";
  }
});

// Filter function
function applyReportFilters() {
  const classFilter = document.getElementById('reportClassSelect').value.toLowerCase();
  const typeFilter = document.getElementById('reportTypeSelect').value.toLowerCase();
  const startDate = document.getElementById('reportStartDate').value;
  const endDate = document.getElementById('reportEndDate').value;
  [...reportTable.rows].forEach(row => {
    const rowClass = row.dataset.class;
    const rowType = row.dataset.type.toLowerCase();
    const rowDate = row.dataset.date;
    const classMatch = classFilter === 'all' || rowClass === classFilter;
    const typeMatch = typeFilter === 'all' || rowType === typeFilter;
    const dateMatch = (!startDate || rowDate >= startDate) && (!endDate || rowDate <= endDate);
    row.style.display = (classMatch && typeMatch && dateMatch) ? '' : 'none';
  });
}

// Event listeners
document.getElementById('reportFilterBtn').addEventListener('click', applyReportFilters);

// Export simulation
document.getElementById('reportExportBtn').addEventListener('click', () => {
  const visibleRows = [...reportTable.rows].filter(row => row.style.display !== 'none');
  if (visibleRows.length === 0) { alert('No reports to export.'); return; }
  alert(`Export simulation: ${visibleRows.length} report(s) would be exported.`);
});

// View report modal with chart and badges
reportTable.addEventListener('click', e => {
  if (!e.target.classList.contains('viewReportBtn')) return;
  const row = e.target.closest('tr');
  reportModalTitle.textContent = `${row.cells[1].innerText} Report - ${row.cells[0].innerText}`;

  // Simulated summary values
  const summary = row.cells[1].innerText === 'Attendance'
    ? { total: 25, present: 23, absent: 2 }
    : { total: 6, sent: 6, failed: 0 };

  let badgesHtml = '';
  if (row.cells[1].innerText === 'Attendance') {
    badgesHtml = `
      <span class="badge bg-success summary-badge">Present: ${summary.present}</span>
      <span class="badge bg-danger summary-badge">Absent: ${summary.absent}</span>
      <span class="badge bg-primary summary-badge">Total: ${summary.total}</span>
    `;
  } else {
    badgesHtml = `
      <span class="badge bg-primary summary-badge">Sent: ${summary.sent}</span>
      <span class="badge bg-warning text-dark summary-badge">Failed: ${summary.failed}</span>
      <span class="badge bg-secondary summary-badge">Total: ${summary.total}</span>
    `;
  }

  reportModalBody.innerHTML = `
    <p><strong>Class:</strong> ${row.cells[0].innerText}</p>
    <p><strong>Type:</strong> ${row.cells[1].innerText}</p>
    <p><strong>Details:</strong> ${row.cells[2].innerText}</p>
    <p><strong>Date:</strong> ${row.cells[3].innerText}</p>
    <div class="mb-3">${badgesHtml}</div>
    <canvas id="reportChart" style="max-height:300px;"></canvas>
  `;

  // Destroy previous chart if exists
  if (chartInstance) chartInstance.destroy();
  const ctx = document.getElementById('reportChart').getContext('2d');

  const labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
  const data = row.cells[1].innerText === 'Attendance'
    ? [summary.present, 22, 24, 25]
    : [2, 3, 1, 6];

  chartInstance = new Chart(ctx, {
    type: 'bar',
    data: { labels: labels, datasets: [{ label: row.cells[1].innerText, data: data, backgroundColor: 'rgba(54, 162, 235, 0.6)', borderColor: 'rgba(54, 162, 235, 1)', borderWidth: 1 }] },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });

  reportModal.show();
});
</script>
</body>
</html>
